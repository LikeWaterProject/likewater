(this.webpackJsonplikewater=this.webpackJsonplikewater||[]).push([[0],{130:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(438),i=n(436);t.a=function(){return r.a.createElement(o.a,{raised:!0,inverted:!0,style:{padding:8,height:292}},r.a.createElement("div",{style:{height:"100%",display:"flex",alignItems:"center"}},r.a.createElement(i.a,{active:!0,inline:"centered"})))}},146:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s}));var a=n(0),r=function(e){(function(e){return!!e.touches})(e)&&e.touches.length>1&&e.preventDefault&&e.preventDefault&&e.preventDefault()},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isPreventDefault,o=void 0===n||n,i=t.delay,c=void 0===i?500:i,l=Object(a.useRef)(),u=Object(a.useRef)(),s=Object(a.useCallback)((function(t,n){var a=n.originalEvent;o&&a.target&&(a.target.addEventListener("touchend",r,{passive:!1}),u.current=a.target),a.touches.length<2&&(l.current=setTimeout((function(){e(t,n)}),c))}),[e,c]),d=Object(a.useCallback)((function(e,t){l.current&&clearTimeout(l.current),o&&u.current&&u.current.removeEventListener("touchend",r)}),[]);return{onTouchStart:s,onTouchEnd:d}},i=n(23),c=n(16),l=function(e){switch(e){case c.a:return{icon:"first-aid-kit",color:"gainsboro"};case c.b:return{icon:"lifebuoy",color:"crimson"};case c.c:return{icon:"broadcast",color:"mediumseagreen"};case c.e:return{icon:"alarm-warning",color:"royalblue"};case c.g:return{icon:"fire",color:"darkorange"};default:return{icon:"pushpin-2",color:"mediumpurple"}}},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){var t=e.eventId,n=e.eventType,a=e.eventDesc,r=e.coordinates,o=e.reportedDt;return Object(i.a)({eventId:t,eventType:n,coordinates:r,eventDesc:a,reportedDt:o},l(n))}))},s=function(e){return Object(a.useMemo)((function(){return u(e)}),[e])}},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"f",(function(){return u}));var a="AID",r="INFO",o="Police Brutality",i="SAFETY",c="SOS",l="PIN",u="POSITION"},17:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"g",(function(){return o})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return d})),n.d(t,"j",(function(){return b})),n.d(t,"m",(function(){return g})),n.d(t,"o",(function(){return h})),n.d(t,"n",(function(){return y})),n.d(t,"p",(function(){return E})),n.d(t,"k",(function(){return O})),n.d(t,"l",(function(){return w}));var a="fetch_events",r="fetch_event_details",o="update_event_filter",i="update_default_position",c="set_current_position",l="set_marker_position",u="set_use_geolocation",s="initialize_user",d="invalidate_user",f=n(30),v=n.n(f),m=n(49),p=n(98),b=function(e){var t=e.coordinates,n=e.radius,r=void 0===n?75e3:n,o=e.userToken,i=void 0===o?"UNASSIGNED":o;return function(){var e=Object(m.a)(v.a.mark((function e(n){var o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/getevents",{coordinates:t,radius:r,userToken:i});case 2:o=e.sent,n({type:a,payload:o.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},g=function(e){var t=e.coordinates,n=e.eventType,a=e.eventDesc,r=e.userToken,o=void 0===r?"UNASSIGNED":r;return function(){var e=Object(m.a)(v.a.mark((function e(r){var i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/reportevent",{coordinates:t,eventType:n,eventDesc:a,userToken:o});case 2:i=e.sent,console.log(i),r(b({coordinates:t,userToken:o}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},h=function(e){return{type:l,payload:e}},y=function(e){return{type:c,payload:e}},E=function(e){return function(){var t=Object(m.a)(v.a.mark((function t(n){var a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.setItem(u,JSON.stringify(e)),t.next=3,navigator.permissions.query({name:"geolocation"});case 3:a=t.sent,a.state,n({type:u,payload:e}),e||n(y(null));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},O=function(){return function(){var e=Object(m.a)(v.a.mark((function e(t,n){var a,r,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=null!==(a=JSON.parse(localStorage.getItem(u)))&&void 0!==a&&a,navigator.permissions.query({name:"geolocation"}).then((function(e){o=e.state,e.onchange=function(e){var a=e.target.state;t({type:u,payload:n().map.shouldUseGeolocation&&"granted"===a})}})),t({type:u,payload:r&&"granted"===o});case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},k=n(453),j=n(455),w=function(){var e,t=null!==(e=JSON.parse(localStorage.getItem(s)))&&void 0!==e?e:{},n=t.userToken,a=t.validUntil;return(!n||!a||Date.now()>a)&&(n=Object(k.a)(),a=Object(j.a)(Date.now(),1).getTime(),localStorage.setItem(s,JSON.stringify({userToken:n,validUntil:a}))),console.log(n,a),{type:s,payload:{userToken:n,validUntil:a}}}},216:function(e,t,n){e.exports=n.p+"static/media/first-aid-kit-fill.f96d703e.svg"},217:function(e,t,n){e.exports=n.p+"static/media/broadcast-fill.d068d7ab.svg"},218:function(e,t,n){e.exports=n.p+"static/media/alarm-warning-fill.129f3113.svg"},219:function(e,t,n){e.exports=n.p+"static/media/fire-fill.feb2802d.svg"},220:function(e,t,n){e.exports=n.p+"static/media/lifebuoy-fill.da569f96.svg"},221:function(e,t,n){e.exports=n.p+"static/media/pushpin-2-fill.466aaf39.svg"},222:function(e,t,n){e.exports=n.p+"static/media/focus-3-line.ec68912f.svg"},252:function(e,t,n){e.exports=n(435)},263:function(e,t,n){},435:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(35),i=n.n(o),c=n(37),l=n(76),u=(n(261),n(262),n(263),n(58)),s=n(450),d=n(138),f=n(17),v=n(454),m=Object(c.b)(null,{setCurrentPosition:f.n})((function(e){var t=e.setCurrentPosition,n=Object(v.a)({enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4});return Object(a.useEffect)((function(){var e=!0;return!n.loading&&n.longitude&&e&&t(n),function(){return e=!1}}),[n,t]),null})),p=n(18),b=n(449),g=n(21),h=n(16),y=n(146),E=n(437),O=Object(c.b)((function(e){return{shouldUseGeolocation:e.map.shouldUseGeolocation}}),{setUseGeolocation:f.p})((function(e){var t=e.context,n=e.shouldUseGeolocation,a=e.setUseGeolocation;return r.a.createElement("div",null,r.a.createElement(E.a,{icon:"location arrow",color:"black",style:{position:"absolute",top:98,right:3},onClick:function(){t.rotateTo(0)}}),r.a.createElement(E.a.Group,{vertical:!0,style:{position:"absolute",top:142,right:6}},r.a.createElement(E.a,{color:"black",icon:"plus",onClick:function(){t.zoomIn()}}),r.a.createElement(E.a,{color:"black",icon:"minus",onClick:function(){t.zoomOut()}})),r.a.createElement(E.a,{color:n?"blue":"black",icon:"crosshairs",style:{position:"absolute",top:222,right:3},onClick:function(){a(!n)}}))})),k=function(e){var t=e.type,n=void 0===t?h.c:t,a=e.events,o=void 0===a?[]:a,i=e.visibility,c=void 0===i||i,l=e.onMouseEvents;return r.a.createElement(g.c,{id:n,type:"symbol",layout:{visibility:c?"visible":"none","icon-image":n,"icon-allow-overlap":!1},paint:{"icon-color":"red","icon-halo-blur":1,"icon-halo-width":40,"icon-halo-color":"#ff0000"}},o.map((function(e){var t=e.eventId,n=e.coordinates,a=n.lon,o=n.lat;return r.a.createElement(g.a,Object.assign({key:t,coordinates:[a,o],properties:e},l))})))},j=n(216),w=n.n(j),I=n(217),S=n.n(I),x=n(218),T=n.n(x),P=n(219),C=n.n(P),_=n(220),M=n.n(_),U=n(221),D=n.n(U),N=n(222),G=n.n(N),z=new Image(24,24);z.src=w.a;var J=new Image(24,24);J.src=S.a;var F=new Image(24,24);F.src=T.a;var A=new Image(24,24);A.src=C.a,new Image(24,24).src=M.a;var B=new Image(24,24);B.src=D.a;var L=new Image(24,24);L.src=G.a;var R,V=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.b,{id:h.a,data:z}),r.a.createElement(g.b,{id:h.c,data:J}),r.a.createElement(g.b,{id:h.e,data:F}),r.a.createElement(g.b,{id:h.g,data:A}),r.a.createElement(g.b,{id:h.b,data:A}),r.a.createElement(g.b,{id:h.d,data:B}),r.a.createElement(g.b,{id:h.f,data:L}))},W=Object(g.e)({accessToken:"pk.eyJ1IjoicmVrdGRlY2thcmQiLCJhIjoiY2theWJ4OXM0MGhiejJ3cnkzcmk0andiYyJ9.IinlG0vyUvcWhvlAREJXeA",attributionControl:!1}),X={defaultZoom:[10],volumetricPainter:{"fill-extrusion-color":"#424d5c","fill-extrusion-height":{type:"identity",property:"height"},"fill-extrusion-base":{type:"identity",property:"min_height"},"fill-extrusion-opacity":.6}},Y=Object(c.b)((function(e){return{map:e.map,events:e.events}}),{setMarkerPosition:f.o})((function(e){var t=e.map,n=e.events,o=e.onMoveEnd,i=e.toggleControls,c=e.setMarkerPosition,l=Object(p.f)(),u=Object(b.a)(),s=u.width,d=u.height,f=t.currentPosition,v=t.defaultPosition,m=t.markerPosition,E=t.showVolumetricBuildings,j=(t.showBasicMapFeatures,n.nearbyEvents),w=n.eventFilters,I=function(e,t){e.map.getCanvas().style.cursor=t},S=Object(a.useCallback)((function(e){var t=e.map,n=e.feature.properties,a=n.eventId,r=n.coordinates;e.originalEvent.preventDefault();var o=JSON.parse(r),c=o.lon,u=o.lat;t.flyTo({center:[c,u],zoom:16}),i(!0),l.push("/events/".concat(a))}),[l,i]),x=Object(a.useMemo)((function(){return{onMouseEnter:function(e){return I(e,"pointer")},onMouseLeave:function(e){return I(e,"")},onClick:S}}),[S]),T=function(e,t){if(!(e.isMoving()||e.isRotating()||e.isZooming())){var n=t.lngLat,a=n.lat,r=n.lng;i(!0),c([r,a]),e.flyTo({center:[r,a],zoom:16}),l.push("/submit")}},P=Object(y.c)(T,{isPreventDefault:!0,delay:500});return console.log(n),r.a.createElement(W,Object.assign({style:"mapbox://styles/rektdeckard/ckayd52rb0xzg1imcbyek0g4y",containerStyle:{width:s,height:d},center:f?[f.longitude,f.latitude]:v,zoom:X.defaultZoom,onStyleLoad:function(e){e.on("click",(function(e){e.originalEvent.defaultPrevented||(c(null),l.push("/"))}))},onContextMenu:T,onMoveEnd:o},P),r.a.createElement(V,null),r.a.createElement(g.d.Consumer,null,(function(e){return r.a.createElement(O,{context:e})})),E&&r.a.createElement(g.c,{id:"3d-buildings",type:"fill-extrusion",sourceId:"composite",sourceLayer:"building",filter:["==","extrude","true"],minZoom:14,paint:X.volumetricPainter}),r.a.createElement(k,{type:h.a,events:j.filter((function(e){return e.eventType===h.a})),onMouseEvents:x,visibility:w.aid}),r.a.createElement(k,{type:h.c,events:j.filter((function(e){return e.eventType===h.c})),onMouseEvents:x,visibility:w.info}),r.a.createElement(k,{type:h.e,events:j.filter((function(e){return e.eventType===h.e})),onMouseEvents:x,visibility:w.police}),r.a.createElement(k,{type:h.g,events:j.filter((function(e){return e.eventType===h.g})),onMouseEvents:x,visibility:w.safety}),r.a.createElement(k,{type:h.b,events:j.filter((function(e){return e.eventType===h.b})),onMouseEvents:x,visibility:w.sos}),m&&r.a.createElement(g.c,{id:"map-marker",type:"symbol",layout:{"icon-image":"PIN","icon-anchor":"bottom","icon-allow-overlap":!0}},r.a.createElement(g.a,{coordinates:m})),f&&r.a.createElement(g.c,{id:"location-marker",type:"symbol",layout:{"icon-image":"POSITION","icon-allow-overlap":!0}},r.a.createElement(g.a,{coordinates:[f.longitude,f.latitude],properties:f})))})),Z=n(438),q=n(452),H=n(451),Q=function(e){e.visible;var t=e.toggleControls,n=Object(a.useState)(""),o=Object(u.a)(n,2),i=o[0],c=o[1];return r.a.createElement(s.a,{as:Z.a,inverted:!0,raised:!0,direction:"top",animation:"push",textAlign:"center",visible:!0,style:{padding:4}},r.a.createElement(q.a,{inverted:!0,borderless:!0,widths:3},r.a.createElement(q.a.Item,null," "),r.a.createElement(q.a.Item,{fitted:!0},r.a.createElement(H.a,{disabled:!0,value:i,onSearchChange:function(e,t){var n=t.value;return c(n)},onFocus:function(){return t(!1)},onBlur:function(){return t(!0)},open:!1})),r.a.createElement(q.a.Menu,{position:"right"},r.a.createElement(q.a.Item,null,r.a.createElement(E.a,{circular:!0,size:"large",color:"black",icon:"setting",floated:"right"})))))},$=n(130),K=r.a.createElement($.a,null),ee=r.a.lazy((function(){return Promise.all([n.e(4),n.e(6)]).then(n.bind(null,488))})),te=r.a.lazy((function(){return n.e(5).then(n.bind(null,492))})),ne=r.a.lazy((function(){return Promise.all([n.e(3),n.e(7)]).then(n.bind(null,489))})),ae=Object(p.h)((function(e){var t=e.visible;return r.a.createElement(s.a,{className:"no-overflow unclickable",animation:"push",direction:"bottom",visible:t,style:{boxShadow:"none"}},r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(E.a,{className:"clickable",circular:!0,compact:!0,color:"black",size:"huge",icon:"bullhorn",onClick:function(){return window.confirm("Send SOS?")}})),r.a.createElement(p.c,null,r.a.createElement(p.a,{path:"/events/:id"},r.a.createElement(a.Suspense,{fallback:K},r.a.createElement(te,null))),r.a.createElement(p.a,{exact:!0,path:"/submit"},r.a.createElement(a.Suspense,{fallback:K},r.a.createElement(ne,null))),r.a.createElement(p.a,{exact:!0,path:"/sos"},r.a.createElement($.a,null)),r.a.createElement(p.a,null,r.a.createElement(a.Suspense,{fallback:K},r.a.createElement(ee,null)))))})),re=Object(c.b)((function(e){return{shouldUseGeolocation:e.map.shouldUseGeolocation,defaultPosition:e.map.defaultPosition}}),{initializeUser:f.l,initializeGeolocation:f.k,getEvents:f.j})((function(e){var t=e.initializeUser,n=e.initializeGeolocation,o=e.shouldUseGeolocation,i=e.defaultPosition,c=e.getEvents,l=Object(a.useState)(!0),f=Object(u.a)(l,2),v=f[0],p=f[1];Object(a.useEffect)((function(){t(),n(),c({coordinates:{lon:i[0],lat:i[1]}})}),[t,n,c,i]);var b=function(e){if("boolean"===typeof e)return p(e);p((function(e){return!e}))};return r.a.createElement(r.a.Fragment,null,o&&r.a.createElement(m,null),r.a.createElement(s.a.Pushable,{className:"no-overflow"},r.a.createElement(Q,{visible:v,toggleControls:b}),r.a.createElement(ae,{visible:v}),r.a.createElement(s.a.Pusher,null,r.a.createElement(Y,{toggleControls:b,onMoveEnd:function(e){var t=e.getCenter(),n=t.lng,a=t.lat,r=e.getBounds(),o=r._sw,i=r._ne,l=Object(d.getDistance)(o,i);c({coordinates:{lon:n,lat:a},radius:l})},onContextMenu:function(e){console.log(e)}}))))})),oe=n(52),ie=n(227),ce=n(23),le={dangerClose:!1,nearbyEvents:[],eventFilters:{aid:!0,info:!0,police:!0,safety:!0,sos:!0}},ue={markerPosition:null,currentPosition:null,defaultPosition:null!==(R=JSON.parse(localStorage.getItem(f.f)))&&void 0!==R?R:[-74,40.73],shouldUseGeolocation:!1,showBasicMapFeatures:!0,showVolumetricBuildings:!0},se={userToken:null,validUntil:null},de=Object(oe.c)({events:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case f.a:return Object(ce.a)(Object(ce.a)({},e),{},{nearbyEvents:a});case f.g:return Object(ce.a)(Object(ce.a)({},e),{},{eventFilters:Object(ce.a)(Object(ce.a)({},e.eventFilters),{},{payload:a})});default:return e}},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case f.h:return Object(ce.a)(Object(ce.a)({},e),{},{markerPosition:a});case f.e:return Object(ce.a)(Object(ce.a)({},e),{},{currentPosition:a});case f.f:return Object(ce.a)(Object(ce.a)({},e),{},{defaultPosition:a});case f.i:return Object(ce.a)(Object(ce.a)({},e),{},{shouldUseGeolocation:a});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case f.c:return a;case f.d:return se;default:return e}}}),fe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||oe.d,ve=Object(oe.e)(de,{},fe(Object(oe.a)(ie.a)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(c.a,{store:ve},r.a.createElement(l.a,null,r.a.createElement(re,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,n){"use strict";var a=n(211),r=n.n(a).a.create({baseURL:"https://likewater-internal.azurewebsites.net/api"});t.a=r}},[[252,1,2]]]);
//# sourceMappingURL=main.6d4b5f4b.chunk.js.map